# 中文序言

每当我们看到一个新的软件，第一反应会是：为什么又要发明一个新软件？`ggplot2`是R世界里相对还比较年轻的一个包，在它之前，官方R已经有自己的基础图形系统（`graphics`包）和网格图形系统（`grid`包），并且Deepayan Sarkar也开发了`lattice`包，看起来R的世界对图形的支持已经足够强大了。那么我们不禁要问，为什么还要发明一套新的系统？

## 设计理念

打个比方，想想我们小时候怎样学中文的。最开始的时候我们要识字，不认识字就没法阅读和写作，但我们并不是一直按照一个个汉字学习的，而是通过句子和具体的场景故事学习的。为什么不在小学时背六年字典呢？那样可能认识所有的汉字。原因很简单，光有单字，我们不会说话，也无法阅读和写作。缺的是什么？答案是对文字的组织能力，或者说语法。

R的基础图形系统基本上是一个“纸笔模型”，即：一块画布摆在面前，你可以在这里画几个点，在那儿画几条线，指哪儿画哪儿。后来`lattice`包的出现稍微改善了这种情况，你可以说，我要画散点图或直方图，并且按照某个分类变量给图中的元素上色，此时数据才在画图中扮演了一点中心角色，我们不用去想具体这个点要用什么颜色（颜色会根据变量自动生成）。然而，`lattice`继承了R语言的一个糟糕特征，就是参数设置铺天盖地，足以让人窒息，光是一份`xyplot()`函数的帮助文档，恐怕就够我们消磨一天时间了，更重要的是，`lattice`仍然面向特定的统计图形，像基础图形系统一样，有直方图、箱线图、条形图等等，它没有一套可以让数据分析者说话的语法。

那么数据分析者是怎样说话的呢？他们从来不会说这条线用`#FE09BE`颜色，那个点用三角形状，他们只会说，把图中的线用数据中的职业类型变量上色，或图中点的形状对应性别变量。有时候他们画了一幅散点图，但马上他们发现这幅图太拥挤，最好是能具体看一下里面不同收入阶层的特征，所以他们会说，把这幅图拆成七幅小图，每幅图对应一个收入阶层。然后发现散点图的趋势不明显，最好加上回归直线，看看回归模型反映的趋势是什么，或者发现图中离群点太多，最好做一下对数变换，减少大数值对图形的主导性。

从始至终，数据分析者都在数据层面上思考问题，而不是拿着水彩笔和调色板在那里一笔一划作图，而计算机程序员则倾向于画点画线。Leland Wilkinson的著作在理论上改善了这种状况，他提出了一套图形语法，让我们在考虑如何构建一幅图形的时候不再陷在具体的图形元素里面，而是把图形拆分为一些互相独立并且可以自由组合的成分。这套语法提出来之后他自己也做了一套软件，但显然这套软件没有被广泛采用，幸运的是，Hadley Wickham在R语言中把这套想法巧妙地实现了。

为了说明这种语法的想法，我们考虑图形中的一个成分：坐标系。常见的坐标系有两种：笛卡尔坐标系和极坐标系。在语法中，它们属于一个成分，可自由拆卸替换。笛卡尔坐标系下的条形图实际上可以对应极坐标系下的饼图，因为条形图的高可以对应饼图的角度，本质上没什么区别。因此在`ggplot2`中，从一幅条形图过渡到饼图，只需要加极少量的代码，把坐标系换一下就可以了。如果我们用纸笔模型，则可以想象，这完全是不同的两幅图，一幅图里面要画的是矩形，另一幅图要画扇形。

更多的细节在本书中会介绍，这里我们只是简略说明用语法画图对用纸笔画图来说在思维上的优越性；前者是说话，后者是说字。

## 发展历程

`ggplot2`是Hadley在爱荷华州立大学博士期间的作品，也是他博士论文的主题之一，实际上`ggplot2`还有个前身`ggplot`，但后来废弃了，某种程度上这也是Hadley写软件的特征，熟悉他的人就知道这不是他第一个“2”版本的包了（还有`reshape2`）。带2的包和原来的包在语法上会有很大的改动，基本上不兼容。尽管如此，他的R代码风格在R社区可谓独树一帜，尤其是他的代码结构很好，可读性很高，`ggplot2`是R代码抽象的一个杰作。读者若感兴趣，可以在GitHub网站上浏览他的包：<https://github.com/hadley>。`ggplot2`发展到0.9版本的时候，内部做了一些大改动，如果你是老用户，那么可能需要阅读下面的小节。

## 版本0.9更新

关于0.9的更新，读者可以从<https://github.com/downloads/hadley/ggplot2/guide-col.pdf>下载一份细致的说明文档，但原文档比较长，而且有些内部更新问题我们也不一定需要了解，因此这里给一段概述。

- `ggplot2`的帮助文档大大扩充了，过去头疼的问题之一就是一个函数里面不知道有哪些可能的参数，例如`opts()`函数，现在已经有了详细说明；
- 新增图例向导函数`guide_legend()`和`guide_colorbar()`，前者可以用来指导图例的排版，例如可以安排图例中元素排为n行m列；后者增强了连续变量图例的展示，例如当我们把颜色映射到一个连续变量上时，过去生成的图例是离散的，现在可以用这个函数生成连续颜色的图例（渐变色）；
- 新增几何对象函数`geom_map()`（让地图语法变得更简单），`geom_raster()`（更高效的`geom_tile()`），`geom_dotplot()`（一维点图，展示变量密度分布）和`geom_violin()`（小提琴，实为密度曲线）
- 新增统计变换函数`stat_summary2d()`（在二维网格上计算数据密度），`stat_summary_hex()`（在六边形“蜂巢”上计算数据密度），`stat_bindot()`（一维点图密度），`stat_ydensity()`（密度曲线，用于小提琴图）


## 致谢

在听说我们翻译完这本书之后Hadley很高兴，给我们发邮件说：

> Hadley's words here.

我们感谢这本书的译者，包括肖楠（第1、2章，邱怡轩审校）、高涛（第3、4章，主伟呈审校）、邱怡轩（第5、6章，肖楠审校）、主伟呈（第7、8章，高涛审校）、魏太云（第9、10章，潘岚锋、韩帅审校）和潘岚锋（附录，魏太云审校）。我们还要感谢三位参加第二次审校的朋友：肖凯（第1-4章）、殷腾飞（第5-7章）和余光创（第8-10章、附录）。

谢益辉
2012年4月8日

